{% extends "base.html" %}

{% block title %}联系我们 - Flask Web 应用{% endblock %}

{% block header_title %}联系我们{% endblock %}

{% block content %}
    <div style="background: #e8f4fd; padding: 20px; border-radius: 5px; margin-bottom: 20px;">
        <h3>📧 Flask-WTF 表单功能演示</h3>
        <p>这个页面演示了如何使用 Flask-WTF 扩展创建专业的表单，包含自动验证、CSRF 保护和错误处理功能。</p>
    </div>

    <!-- Flash 消息显示 -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="flash-message flash-{{ category }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div style="background: #f8f9fa; padding: 20px; border-radius: 5px; margin-bottom: 20px;">
        <h4>📋 表单功能特点</h4>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 15px;">
            <div style="background: white; padding: 10px; border-radius: 3px; text-align: center; border: 1px solid #dee2e6;">
                <strong>🔒 CSRF 保护</strong><br>
                自动防御跨站请求伪造攻击
            </div>
            <div style="background: white; padding: 10px; border-radius: 3px; text-align: center; border: 1px solid #dee2e6;">
                <strong>✅ 数据验证</strong><br>
                自动验证邮箱格式和必填字段
            </div>
            <div style="background: white; padding: 10px; border-radius: 3px; text-align: center; border: 1px solid #dee2e6;">
                <strong>🛠️ 错误处理</strong><br>
                友好的错误提示和自动表单填充
            </div>
        </div>
    </div>

    <div style="background: white; padding: 30px; border-radius: 5px; border: 1px solid #dee2e6; margin-bottom: 20px;">
        <h4>📝 联系我们</h4>
        <p style="color: #6c757d; margin-bottom: 20px;">请填写下面的表单，我们会尽快回复您的消息。</p>

        <form method="POST" action="{{ url_for('contact') }}" novalidate>
            <!-- 1. 这是 CSRF 保护令牌，必须添加！ -->
            {{ form.hidden_tag() }}

            <div style="margin-bottom: 20px;">
                <!-- 2. 渲染 Label 和输入框 -->
                {{ form.name.label(style="display: block; margin-bottom: 5px; font-weight: bold;") }}<br>
                {{ form.name(size=30, class="form-input", style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px;") }}

                <!-- 3. 渲染验证错误信息 -->
                {% if form.name.errors %}
                    <div style="margin-top: 5px;">
                        {% for error in form.name.errors %}
                            <div style="color: #dc3545; font-size: 14px;">{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div style="margin-bottom: 20px;">
                {{ form.email.label(style="display: block; margin-bottom: 5px; font-weight: bold;") }}<br>
                {{ form.email(size=30, class="form-input", style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px;") }}
                {% if form.email.errors %}
                    <div style="margin-top: 5px;">
                        {% for error in form.email.errors %}
                            <div style="color: #dc3545; font-size: 14px;">{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div style="margin-bottom: 20px;">
                {{ form.message.label(style="display: block; margin-bottom: 5px; font-weight: bold;") }}<br>
                {{ form.message(rows=5, cols=32, class="form-input", style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px; resize: vertical;") }}
                {% if form.message.errors %}
                    <div style="margin-top: 5px;">
                        {% for error in form.message.errors %}
                            <div style="color: #dc3545; font-size: 14px;">{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div>
                {{ form.submit(class="btn btn-primary", style="background: #007bff; color: white; padding: 12px 30px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;") }}
            </div>
        </form>
    </div>

    <div style="background: #fff3cd; padding: 20px; border-radius: 5px; margin-bottom: 20px;">
        <h4>💡 使用说明</h4>
        <div style="margin-top: 15px;">
            <h5>🧪 测试验证功能：</h5>
            <ol style="margin: 10px 0; padding-left: 20px;">
                <li><strong>空字段测试</strong>：直接点击提交，会看到所有字段的红色错误提示</li>
                <li><strong>邮箱验证</strong>：输入无效邮箱（如 "abc"），会看到邮箱格式验证错误</li>
                <li><strong>成功提交</strong>：填写所有有效信息后提交，会看到成功消息</li>
            </ol>
        </div>

        <div style="margin-top: 20px;">
            <h5>🛡️ 安全特性：</h5>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li><strong>CSRF 令牌</strong>：表单包含隐藏的 CSRF 保护令牌</li>
                <li><strong>数据验证</strong>：服务器端验证确保数据完整性</li>
                <li><strong>错误处理</strong>：安全的错误信息显示</li>
                <li><strong>防止注入</strong>：WTForms 自动防止 XSS 攻击</li>
            </ul>
        </div>
    </div>

    <div style="background: #d1ecf1; padding: 20px; border-radius: 5px;">
        <h4>🛠️ 技术实现要点</h4>
        <div style="margin-top: 15px;">
            <h5>后端技术：</h5>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li><strong>FlaskForm</strong>：所有表单类继承自 FlaskForm</li>
                <li><strong>validators</strong>：使用 DataRequired, Email 等验证器</li>
                <li><strong>validate_on_submit()</strong>：优雅的表单处理方法</li>
                <li><strong>form.data</strong>：安全地获取表单数据</li>
            </ul>
        </div>

        <div style="margin-top: 15px;">
            <h5>模板技术：</h5>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li><strong>{{ form.hidden_tag() }}</strong>：自动生成 CSRF 令牌</li>
                <li><strong>{{ form.name.label }}</strong>：自动生成标签元素</li>
                <li><strong>{{ form.name() }}</strong>：自动生成输入框</li>
                <li><strong>{{ form.name.errors }}</strong>：显示验证错误信息</li>
            </ul>
        </div>
    </div>
{% endblock %}